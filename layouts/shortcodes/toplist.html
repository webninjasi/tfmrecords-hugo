
{{ $.Scratch.Set "completions" dict }}
{{ range .Site.Data.maps }}
    {{ range first 5 .records }}
        {{ $completions := $.Scratch.Get "completions" }}
        {{ $nameLC := lower (trim .name " ") }}
        {{ $.Scratch.Set "completions" (merge $completions (dict $nameLC (add 1 (or (index $completions $nameLC) 0)))) }}
    {{ end }}
    {{ range first 5 .recordsReversed }}
        {{ $completions := $.Scratch.Get "completions" }}
        {{ $nameLC := lower (trim .name " ") }}
        {{ $.Scratch.Set "completions" (merge $completions (dict $nameLC (add 1 (or (index $completions $nameLC) 0)))) }}
    {{ end }}
{{ end }}

{{ $.Scratch.Set "toplist" slice }}
{{ range $name, $num := .Scratch.Get "completions" }}
    {{ $.Scratch.Add "toplist" (dict "name" $name "num" $num) }}
{{ end }}

{{ $toplist := .Scratch.Get "toplist" }}

<table class="table">
    <thead>
        <tr>
        <th scope="col">#</th>
        <th scope="col">Name</th>
        <th scope="col">Maps Completed</th>
        </tr>
    </thead>
    <tbody>
        {{ range $idx, $top := first 10 (sort $toplist "num" "desc") }}
        <tr>
            <td>{{ add 1 $idx }}</td>
            <td><a href="/players/{{ (replace $top.name "#" "%23") }}/">{{ replace (humanize $top.name) " " "_" }}</a></td>
            <td>{{ $top.num }}</td>
        </tr>
        {{ end }}
    </tbody>
</table>
